# Dora the Explorer

## Endpoints

1. `GET /` Hello Dora
1. `GET /id` The id of the instance
1. `POST /session` Sets up the cookies for a sticky session
1. `GET /session` Sets up the cookies for a sticky session via a GET request. This endpoint allows for easy experimentation
with sticky sessions in the browser.
1. `POST /stress_testers?cpu=1&io=1` Starts the stress tester with 1 cpu and 1 io process
1. `GET /stress_testers` Gets all the stress testers processes
1. `DELETE /stress_testers` Kill all the stress testers processes
1. `GET /find/:filename` Finds a file in your instance
1. `GET /sigterm` Displays all possible sigterms
1. `GET /delay/:seconds` Waits for n seconds
1. `GET /sigterm/:signal` Sends the specfied signal
1. `GET /logspew/:bytes` Spews out n bytes to the logs
1. `GET /loglines/:linecount` Writes n lines to stdout, each line contains a timestamp with nanoseconds
1. `GET /loglines/:linecount/:tag` Writes n lines to stdout, each line contains a timestamp with nanoseconds and the given tag
1. `GET /log/sleep/count` Returns a count of the log messages logged by the log service
1. `GET /log/sleep/running` Returns whether the log service is running
1. `GET /log/sleep/:logspeed/limit/:limit` Produces logspeed output with the given parameters
1. `GET /log/sleep/:logspeed` Produces logspeed output without limit
1. `GET /log/stop` Stops the log service
1. `GET /log/bytesize/:bytesize` Produces continuous log entries of the given bytesize
1. `GET /echo/:destination/:output` Echos out the output to the destination
1. `GET /env/:name` Prints out the environment variable `:name`
1. `GET /env` Prints out the entire environment as a serialized Ruby hash
1. `GET /env.json` Prints out the entire environment as a JSON object
1. `GET /largetext/:kbytes` Returns a dummy response of size `:kbytes`. For testing large payloads.
1. `GET /health` Returns 500 the first 3 times you call it, "I'm alive" thereafter
1. `GET /ping/:address` Pings the given address 4 times
1. `GET /lsb_release` Returns information about the Linux distribution of the container
1. `GET /dpkg/:package` Returns the output of `dpkg -l` for the given packange
1. `GET /myip` Returns the IP of the app container
1. `GET /curl/:host/?:port?` cURLs the given host and port and returns the stdout, stderr, and status as JSON

## Sticky Sessions
In order to initiate a sticky session on cf for vms, an app must set the `JSESSIONID` cookie on a response. When the Gorouter sees this
cookie set on a request, then the Gorouter sets the `VCAP_ID` cookie. This `VCAP_ID` cookie is the app instance guid. Note that sticky sessions
for apps are not currently supported in cf-for-k8s.

In subsequent requests if the client wants sticky sessions, the client must send these cookies in the request.
When Gorouter gets a request with a `VCAP_ID` cookie set then it will route to that app instance if it is available.

### Example via curl

1. Sticky sessions aren't very interesting when there is only one instance. Make sure there is more than one instance of Dora.
    ```bash
    cf scale dora -i 2
    ```
1. When a request is sent to the `/session` endpoint Dora sets the `JSESSIONID` cookie. The `-c` flag for curl
saves the cookies in the response to a file.
Get your sticky session cookies by running:
    ```bash
    curl dora.yourdomain.com/session -c my_cookies
    ```
1. Your `my_cookies` file should contain the `JSESSIONID` and the `VCAP_ID` cookies. For Dora these are the same value.
Look at your cookies by running: 
    ```bash
    cat my_cookies
    ```
    The cookies should look something like this: 
    ```text
    # Netscape HTTP Cookie File
    # https://curl.haxx.se/docs/http-cookies.html
    # This file was generated by libcurl! Edit at your own risk.

    dora.yourdomain.com	FALSE	/	FALSE	0	JSESSIONID	342b98fe-b43c-4642-7d59-eeee
    #HttpOnly_dora.yourdomain.com	FALSE	/	FALSE	0	__VCAP_ID__	342b98fe-b43c-4642-7d59-eeee
    ```
1. Now when you send requests to Dora you can pass these cookies by using the `-b` flag for curl.
Try sending a request to the `/id` endpoint with the cookies. This endpoint responds with the app instance guid.
No matter how many times you curl this endpoint, when you send the cookies it should always route to the same app instance.
    ```bash
    curl dora.yourdomain.com/id -b my_cookies
    ```

### Example via the browser

1. Sticky sessions aren't very interesting when there is only one instance. Make sure there is more than one instance of Dora.
    ```bash
    cf scale dora -i 2
    ```

1. In your browser go to `dora.yourdomain.com/id`. When you refresh the page you should see the app instance guid change because
Gorouter is routing to different app instances each time.

1. In your browser go to `dora.yourdomain.com/session`. When a request is sent to the `/session` endpoint Dora sets the `JSESSIONID` cookie.
After you visit this URL the cookies are set in your browser. I will leave it as an exercise for the reader to find the cookies and their values.

1. In your browser go to `dora.yourdomain.com/id`. When you refresh the page you should see the app instance guid remain
the same because sticky sessions are in use.
